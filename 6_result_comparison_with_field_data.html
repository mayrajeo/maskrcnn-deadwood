<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Janne Mäyrä">
<meta name="dcterms.date" content="2022-12-22">

<title>Automated deadwood detection from UAV RGB imagery - Result comparison with field data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./7_deriving_standwise_metrics_for_evo.html" rel="next">
<link href="./5_scene_level_results.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Automated deadwood detection from UAV RGB imagery - Result comparison with field data">
<meta property="og:description" content="Here we first compare the annotations and predictions in field plot level metrics, and then do the same for predictions and field data.">
<meta property="og:site-name" content="Automated deadwood detection from UAV RGB imagery">
<meta name="twitter:title" content="Automated deadwood detection from UAV RGB imagery - Result comparison with field data">
<meta name="twitter:description" content="Here we first compare the annotations and predictions in field plot level metrics, and then do the same for predictions and field data.">
<meta name="twitter:creator" content="@mayrajeo">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Automated deadwood detection from UAV RGB imagery</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jaeeolma/maskrcnn-deadwood/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Result comparison with field data</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0_index.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Workflow</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_dataset_description_and_generation.html" class="sidebar-item-text sidebar-link">Dataset description and generation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_comparing_annotations_and_field_data.html" class="sidebar-item-text sidebar-link">Comparison of plot characteristics and digitized deadwood</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_mask_rcnn_model_training.html" class="sidebar-item-text sidebar-link">Mask R-CNN model training</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_patch_level_results.html" class="sidebar-item-text sidebar-link">Patch level results</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_scene_level_results.html" class="sidebar-item-text sidebar-link">Scene level results</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_result_comparison_with_field_data.html" class="sidebar-item-text sidebar-link active">Result comparison with field data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7_deriving_standwise_metrics_for_evo.html" class="sidebar-item-text sidebar-link">Deriving deadwood statistics for full Evo study area</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8_configs.html" class="sidebar-item-text sidebar-link">Running models with your own data</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#hiidenportti" id="toc-hiidenportti" class="nav-link active" data-scroll-target="#hiidenportti"><span class="toc-section-number">1</span>  Hiidenportti</a>
  <ul class="collapse">
  <li><a href="#predictions-vs-annotations-with-all-data-present-in-the-scenes" id="toc-predictions-vs-annotations-with-all-data-present-in-the-scenes" class="nav-link" data-scroll-target="#predictions-vs-annotations-with-all-data-present-in-the-scenes"><span class="toc-section-number">1.1</span>  Predictions vs annotations, with all data present in the scenes</a></li>
  <li><a href="#predictions-vs-field-data-with-only-predictions-present-in-field-plots" id="toc-predictions-vs-field-data-with-only-predictions-present-in-field-plots" class="nav-link" data-scroll-target="#predictions-vs-field-data-with-only-predictions-present-in-field-plots"><span class="toc-section-number">1.2</span>  Predictions vs field data, with only predictions present in field plots</a></li>
  </ul></li>
  <li><a href="#sudenpesänkangas" id="toc-sudenpesänkangas" class="nav-link" data-scroll-target="#sudenpesänkangas"><span class="toc-section-number">2</span>  Sudenpesänkangas</a>
  <ul class="collapse">
  <li><a href="#predictions-vs-annotations-all-available-data" id="toc-predictions-vs-annotations-all-available-data" class="nav-link" data-scroll-target="#predictions-vs-annotations-all-available-data"><span class="toc-section-number">2.1</span>  Predictions vs annotations, all available data</a></li>
  <li><a href="#predictions-vs-field-data-plot-wise" id="toc-predictions-vs-field-data-plot-wise" class="nav-link" data-scroll-target="#predictions-vs-field-data-plot-wise"><span class="toc-section-number">2.2</span>  Predictions vs field data, plot-wise</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jaeeolma/maskrcnn-deadwood/blob/main/notebooks/6_result_comparison_with_field_data.ipynb" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Result comparison with field data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Janne Mäyrä </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 22, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> drone_detector.utils <span class="im">import</span> <span class="op">*</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> drone_detector.imports <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio.mask <span class="im">as</span> rio_mask</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'whitegrid'</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'..'</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.tree_functions <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here we first compare the annotations and predictions in field plot level metrics, and then do the same for predictions and field data. Comparison between annotations and predictions is done with all data within the scenes, whereas the comparisons between predictions and field data are done with the predictions intersecting the field plot circle.</p>
<section id="hiidenportti" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Hiidenportti</h1>
<p>Read data and do some wrangling. Hiidenportti data comparisons are done only with the five test scenes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>field_data_path <span class="op">=</span> Path(<span class="st">'../data/hiidenportti'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>anns <span class="op">=</span> gpd.read_file(<span class="st">'../../data/raw/hiidenportti/virtual_plots/all_deadwood_hiidenportti.geojson'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> gpd.read_file(<span class="st">'../results/hiidenportti/merged_all_20220823.geojson'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>plot_circles <span class="op">=</span> gpd.read_file(field_data_path<span class="op">/</span><span class="st">'plot_circles.geojson'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>field_data <span class="op">=</span> pd.read_csv(field_data_path<span class="op">/</span><span class="st">'all_plot_data.csv'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>virtual_plot_grid <span class="op">=</span> gpd.read_file(field_data_path<span class="op">/</span><span class="st">'envelopes_with_trees.geojson'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>conservation_areas <span class="op">=</span> gpd.read_file(<span class="st">'../data/common/LsAlueValtio.shp'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>cons_hp <span class="op">=</span> conservation_areas[conservation_areas.geometry.intersects(box(<span class="op">*</span>anns.total_bounds))]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>cons_hp <span class="op">=</span> gpd.clip(cons_hp, virtual_plot_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Filter plot circles so that only those present in scenes remain.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>plot_circles[<span class="st">'in_vplot'</span>] <span class="op">=</span> plot_circles.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="dv">1</span> <span class="cf">if</span> <span class="bu">any</span>(virtual_plot_grid.geometry.contains(row.geometry)) </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                                              <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>plot_circles[<span class="st">'id'</span>] <span class="op">=</span> plot_circles[<span class="st">'id'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>field_data <span class="op">=</span> field_data[field_data.<span class="bu">id</span>.isin(plot_circles[plot_circles.in_vplot<span class="op">==</span><span class="dv">1</span>].<span class="bu">id</span>.unique())]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>field_data.rename(columns<span class="op">=</span> {c: c.replace(<span class="st">'.'</span>,<span class="st">'_'</span>) <span class="cf">for</span> c <span class="kw">in</span> field_data.columns}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>dw_cols <span class="op">=</span> [<span class="st">'id'</span>] <span class="op">+</span> [c <span class="cf">for</span> c <span class="kw">in</span> field_data.columns <span class="cf">if</span> <span class="st">'dw'</span> <span class="kw">in</span> c]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>plot_dw_data <span class="op">=</span> field_data[dw_cols].copy()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>plot_circles <span class="op">=</span> plot_circles[plot_circles.in_vplot <span class="op">==</span> <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tree_data <span class="op">=</span> pd.read_csv(field_data_path<span class="op">/</span><span class="st">'hp_tree_data_fixed_1512.csv'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>tree_data <span class="op">=</span> tree_data[tree_data.plot_id.isin(plot_dw_data.<span class="bu">id</span>.unique())]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>tree_data.drop(tree_data[(tree_data.plot_set <span class="op">==</span> <span class="st">'EDNA_45'</span>) <span class="op">&amp;</span> (tree_data.tree_class <span class="op">==</span> <span class="dv">4</span>) <span class="op">&amp;</span> (tree_data.DBH <span class="op">&lt;</span> <span class="dv">100</span>)].index, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Count the number of deadwood (<code>n_dw</code>), fallen deadwood (<code>n_ddw</code>) and standing deadwood (<code>n_udw</code>) from the individual field data measurements.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'n_dw_plot'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">id</span>.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="bu">len</span>(tree_data[tree_data.plot_id <span class="op">==</span> row]))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'n_ddw_plot'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">id</span>.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="bu">len</span>(tree_data[(tree_data.plot_id <span class="op">==</span> row) </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                                                                             <span class="op">&amp;</span> (tree_data.tree_class <span class="op">==</span> <span class="dv">4</span>)]))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'n_udw_plot'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">id</span>.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="bu">len</span>(tree_data[(tree_data.plot_id <span class="op">==</span> row) </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                                                                             <span class="op">&amp;</span> (tree_data.tree_class <span class="op">==</span> <span class="dv">3</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Some helper functions for data matching.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> match_circular_plot(row, plots):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Match annotations with field plots"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> plots.itertuples():</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row.geometry.intersects(p.geometry):</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">int</span>(p.<span class="bu">id</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> match_vplot(row, plots):</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Match annotations with field plots"</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> plots.itertuples():</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row.geometry.intersects(p.geometry):</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f'</span><span class="sc">{</span>p<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>p<span class="sc">.</span>level_1<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>anns[<span class="st">'plot_id'</span>] <span class="op">=</span> anns.<span class="bu">apply</span>(<span class="kw">lambda</span> row: match_circular_plot(row, plot_circles), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>anns_in_plots <span class="op">=</span> anns.overlay(plot_circles[[<span class="st">'geometry'</span>]])</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>anns_in_plots[<span class="st">'plot_id'</span>] <span class="op">=</span> anns_in_plots.plot_id.astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Add relevant information to predictions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>preds[<span class="st">'conservation'</span>] <span class="op">=</span> preds.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="dv">1</span> <span class="cf">if</span> <span class="bu">any</span>(cons_hp.geometry.contains(row))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                                                         <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>preds[<span class="st">'plot_id'</span>] <span class="op">=</span> preds.<span class="bu">apply</span>(<span class="kw">lambda</span> row: match_circular_plot(row, plot_circles), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>preds_in_plots <span class="op">=</span> preds.overlay(plot_circles[[<span class="st">'geometry'</span>]])</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>preds_in_plots[<span class="st">'plot_id'</span>] <span class="op">=</span> preds_in_plots.plot_id.astype(<span class="bu">int</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>preds[<span class="st">'vplot_id'</span>] <span class="op">=</span> preds.<span class="bu">apply</span>(<span class="kw">lambda</span> row: match_vplot(row, virtual_plot_grid), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Filter only test areas</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>anns_in_plots <span class="op">=</span> anns_in_plots[anns_in_plots.plot_id.isin(preds_in_plots.plot_id.unique())]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>plot_dw_data <span class="op">=</span> plot_dw_data[plot_dw_data.<span class="bu">id</span>.isin(preds_in_plots.plot_id.unique())]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>anns <span class="op">=</span> anns[anns.vplot_id.isin(preds.vplot_id.unique())]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="predictions-vs-annotations-with-all-data-present-in-the-scenes" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="predictions-vs-annotations-with-all-data-present-in-the-scenes"><span class="header-section-number">1.1</span> Predictions vs annotations, with all data present in the scenes</h2>
<p>First crosstab the numbers of different deadwood types. First annotations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pd.crosstab(anns.conservation, anns.layer, margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>layer</th>
      <th>groundwood</th>
      <th>uprightwood</th>
      <th>All</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>916</td>
      <td>181</td>
      <td>1097</td>
    </tr>
    <tr>
      <th>1</th>
      <td>485</td>
      <td>159</td>
      <td>644</td>
    </tr>
    <tr>
      <th>All</th>
      <td>1401</td>
      <td>340</td>
      <td>1741</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Then predictions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pd.crosstab(preds.conservation, preds.layer, margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>layer</th>
      <th>groundwood</th>
      <th>uprightwood</th>
      <th>All</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1211</td>
      <td>373</td>
      <td>1584</td>
    </tr>
    <tr>
      <th>1</th>
      <td>792</td>
      <td>191</td>
      <td>983</td>
    </tr>
    <tr>
      <th>All</th>
      <td>2003</td>
      <td>564</td>
      <td>2567</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Add tree length and diameter estimations and check them for groundwood.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>anns[<span class="st">'tree_length'</span>] <span class="op">=</span> anns.geometry.<span class="bu">apply</span>(get_len)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>preds[<span class="st">'tree_length'</span>] <span class="op">=</span> preds.geometry.<span class="bu">apply</span>(get_len)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>anns[<span class="st">'diam'</span>] <span class="op">=</span> anns.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: np.mean(get_three_point_diams(row))) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>preds[<span class="st">'diam'</span>] <span class="op">=</span> preds.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: np.mean(get_three_point_diams(row))) <span class="op">*</span> <span class="dv">1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Distributions for length look pretty similar, though there are some clear outliers in the predictions.</p>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Diameter distributions differ mostly in the 150-175mm class, which is overrepresented for predictions in managed forests.</p>
<p>Check the statistics for diameter and length.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>anns[anns.layer<span class="op">==</span><span class="st">'groundwood'</span>].pivot_table(index<span class="op">=</span><span class="st">'conservation'</span>, values<span class="op">=</span>[<span class="st">'diam'</span>, <span class="st">'tree_length'</span>], </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                           margins<span class="op">=</span><span class="va">True</span>, aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">mean</th>
      <th colspan="2" halign="left">min</th>
      <th colspan="2" halign="left">max</th>
    </tr>
    <tr>
      <th></th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>194.449747</td>
      <td>2.621222</td>
      <td>89.906915</td>
      <td>0.383440</td>
      <td>558.643918</td>
      <td>15.087245</td>
    </tr>
    <tr>
      <th>1</th>
      <td>220.942312</td>
      <td>3.208590</td>
      <td>87.563515</td>
      <td>0.371857</td>
      <td>614.556062</td>
      <td>12.617573</td>
    </tr>
    <tr>
      <th>All</th>
      <td>203.620977</td>
      <td>2.824558</td>
      <td>87.563515</td>
      <td>0.371857</td>
      <td>614.556062</td>
      <td>15.087245</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>preds[preds.layer<span class="op">==</span><span class="st">'groundwood'</span>].pivot_table(index<span class="op">=</span><span class="st">'conservation'</span>, values<span class="op">=</span>[<span class="st">'diam'</span>, <span class="st">'tree_length'</span>], </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                                           margins<span class="op">=</span><span class="va">True</span>, aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">mean</th>
      <th colspan="2" halign="left">min</th>
      <th colspan="2" halign="left">max</th>
    </tr>
    <tr>
      <th></th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>181.405153</td>
      <td>2.390542</td>
      <td>73.158266</td>
      <td>0.234854</td>
      <td>416.484903</td>
      <td>20.598724</td>
    </tr>
    <tr>
      <th>1</th>
      <td>187.242699</td>
      <td>2.351327</td>
      <td>95.175610</td>
      <td>0.472634</td>
      <td>483.888458</td>
      <td>11.152778</td>
    </tr>
    <tr>
      <th>All</th>
      <td>183.713359</td>
      <td>2.375036</td>
      <td>73.158266</td>
      <td>0.234854</td>
      <td>483.888458</td>
      <td>20.598724</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Check the area covered by standing deadwood canopies. First annotations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>anns[<span class="st">'area_m2'</span>] <span class="op">=</span> anns.geometry.area</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>preds[<span class="st">'area_m2'</span>] <span class="op">=</span> preds.geometry.area</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>anns[anns.layer<span class="op">==</span><span class="st">'uprightwood'</span>].pivot_table(index<span class="op">=</span><span class="st">'conservation'</span>, values<span class="op">=</span>[<span class="st">'area_m2'</span>], margins<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                                            aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'sum'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mean</th>
      <th>sum</th>
    </tr>
    <tr>
      <th></th>
      <th>area_m2</th>
      <th>area_m2</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.066763</td>
      <td>555.084039</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.061288</td>
      <td>645.744719</td>
    </tr>
    <tr>
      <th>All</th>
      <td>3.531849</td>
      <td>1200.828758</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Then predictions. Predictions seem to slightly underestimate the sizes of standing deadwood canopies.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>preds[preds.layer<span class="op">==</span><span class="st">'uprightwood'</span>].pivot_table(index<span class="op">=</span><span class="st">'conservation'</span>, values<span class="op">=</span>[<span class="st">'area_m2'</span>], margins<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                              aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'sum'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mean</th>
      <th>sum</th>
    </tr>
    <tr>
      <th></th>
      <th>area_m2</th>
      <th>area_m2</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.574031</td>
      <td>960.113404</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.667250</td>
      <td>700.444729</td>
    </tr>
    <tr>
      <th>All</th>
      <td>2.944252</td>
      <td>1660.558133</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Check the volume estimations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>anns[<span class="st">'v_ddw'</span>] <span class="op">=</span> anns.geometry.<span class="bu">apply</span>(cut_cone_volume)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>preds[<span class="st">'v_ddw'</span>] <span class="op">=</span> preds.geometry.<span class="bu">apply</span>(cut_cone_volume)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>virtual_plot_grid[<span class="st">'vplot_id'</span>] <span class="op">=</span> virtual_plot_grid.<span class="bu">apply</span>(<span class="kw">lambda</span> p: <span class="ss">f'</span><span class="sc">{</span>p<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>p<span class="sc">.</span>level_1<span class="sc">}</span><span class="ss">'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>test_cons_areas <span class="op">=</span> cons_hp.overlay(virtual_plot_grid[virtual_plot_grid.vplot_id.isin(preds.vplot_id.unique())])</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>test_vplot_area <span class="op">=</span> virtual_plot_grid[virtual_plot_grid.vplot_id.isin(preds.vplot_id.unique())].area.<span class="bu">sum</span>()</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>test_cons_area <span class="op">=</span> test_cons_areas.area.<span class="bu">sum</span>()</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>test_man_area <span class="op">=</span> test_vplot_area <span class="op">-</span> test_cons_area</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>test_man_ha <span class="op">=</span> test_man_area <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>test_cons_ha <span class="op">=</span> test_cons_area <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>ann_est_v_man <span class="op">=</span> anns[(anns.layer<span class="op">==</span><span class="st">'groundwood'</span>)<span class="op">&amp;</span>(anns.conservation<span class="op">==</span><span class="dv">0</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>test_man_ha</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>ann_est_v_cons <span class="op">=</span> anns[(anns.layer<span class="op">==</span><span class="st">'groundwood'</span>)<span class="op">&amp;</span>(anns.conservation<span class="op">==</span><span class="dv">1</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>test_cons_ha</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>ann_est_v_test <span class="op">=</span> anns[(anns.layer<span class="op">==</span><span class="st">'groundwood'</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>(test_vplot_area<span class="op">/</span><span class="dv">10000</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>pred_est_v_man <span class="op">=</span> preds[(preds.layer<span class="op">==</span><span class="st">'groundwood'</span>)<span class="op">&amp;</span>(preds.conservation<span class="op">==</span><span class="dv">0</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>test_man_ha</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>pred_est_v_cons <span class="op">=</span> preds[(preds.layer<span class="op">==</span><span class="st">'groundwood'</span>)<span class="op">&amp;</span>(preds.conservation<span class="op">==</span><span class="dv">1</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>test_cons_ha</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>pred_est_v_test <span class="op">=</span> preds[(preds.layer<span class="op">==</span><span class="st">'groundwood'</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>(test_vplot_area<span class="op">/</span><span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in managed forests, based on annotations: </span><span class="sc">{</span>ann_est_v_man<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in conserved forests, based on annotations: </span><span class="sc">{</span>ann_est_v_cons<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in both types, based on annotations: </span><span class="sc">{</span>ann_est_v_test<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Estimated groundwood volume in managed forests, based on annotations: 13.05 ha/m³
Estimated groundwood volume in conserved forests, based on annotations: 14.05 ha/m³
Estimated groundwood volume in both types, based on annotations: 13.50 ha/m³</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in managed forests, based on predictions: </span><span class="sc">{</span>pred_est_v_man<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in conserved forests, based on predictions: </span><span class="sc">{</span>pred_est_v_cons<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in both types, based on predictions: </span><span class="sc">{</span>pred_est_v_test<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Estimated groundwood volume in managed forests, based on predictions: 15.02 ha/m³
Estimated groundwood volume in conserved forests, based on predictions: 13.74 ha/m³
Estimated groundwood volume in both types, based on predictions: 14.43 ha/m³</code></pre>
</div>
</div>
</section>
<section id="predictions-vs-field-data-with-only-predictions-present-in-field-plots" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="predictions-vs-field-data-with-only-predictions-present-in-field-plots"><span class="header-section-number">1.2</span> Predictions vs field data, with only predictions present in field plots</h2>
<p>Count the number of annotated deadwood instances in each circular field plot, as well as note which of the circular plots are located in the conserved areas.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'n_dw_ann'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: anns_in_plots.plot_id.value_counts()[row.<span class="bu">id</span>] </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                                              <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> anns_in_plots.plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'n_ddw_ann'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: anns_in_plots[anns_in_plots.groundwood<span class="op">==</span><span class="dv">2</span>].plot_id.value_counts()[row.<span class="bu">id</span>] </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                                              <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> anns_in_plots[anns_in_plots.groundwood<span class="op">==</span><span class="dv">2</span>].plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'n_udw_ann'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: anns_in_plots[anns_in_plots.groundwood<span class="op">==</span><span class="dv">1</span>].plot_id.value_counts()[row.<span class="bu">id</span>] </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                                              <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> anns_in_plots[anns_in_plots.groundwood<span class="op">==</span><span class="dv">1</span>].plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'geometry'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: plot_circles[plot_circles.<span class="bu">id</span> <span class="op">==</span> row.<span class="bu">id</span>].geometry.iloc[<span class="dv">0</span>], </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                                              axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>plot_dw_data <span class="op">=</span> gpd.GeoDataFrame(plot_dw_data, crs<span class="op">=</span>plot_circles.crs)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'conservation'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="dv">1</span> <span class="cf">if</span> <span class="bu">any</span>(cons_hp.geometry.contains(row.geometry))</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                                                  <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'n_dw_pred'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: preds_in_plots.plot_id.value_counts()[row.<span class="bu">id</span>] </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                                              <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> preds_in_plots.plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'n_ddw_pred'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: preds_in_plots[preds_in_plots.label<span class="op">==</span><span class="dv">2</span>].plot_id.value_counts()[row.<span class="bu">id</span>] </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                                              <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> preds_in_plots[preds_in_plots.label<span class="op">==</span><span class="dv">2</span>].plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'n_udw_pred'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: preds_in_plots[preds_in_plots.label<span class="op">==</span><span class="dv">1</span>].plot_id.value_counts()[row.<span class="bu">id</span>] </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                                              <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> preds_in_plots[preds_in_plots.label<span class="op">==</span><span class="dv">1</span>].plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Compare the numbers of annotations (<code>n_*_ann</code>), predictions (<code>n_*_pred</code>) and field measured (<code>n_*_plot</code>) deadwood instances.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plot_dw_data.pivot_table(index<span class="op">=</span><span class="st">'conservation'</span>, values<span class="op">=</span>[<span class="st">'n_ddw_plot'</span>, <span class="st">'n_udw_plot'</span>, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">'n_ddw_ann'</span>, <span class="st">'n_udw_ann'</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">'n_ddw_pred'</span>, <span class="st">'n_udw_pred'</span>], </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                         aggfunc<span class="op">=</span><span class="st">'sum'</span>, margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>n_ddw_ann</th>
      <th>n_ddw_plot</th>
      <th>n_ddw_pred</th>
      <th>n_udw_ann</th>
      <th>n_udw_plot</th>
      <th>n_udw_pred</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>44</td>
      <td>43</td>
      <td>57</td>
      <td>13</td>
      <td>12</td>
      <td>15</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11</td>
      <td>45</td>
      <td>22</td>
      <td>4</td>
      <td>8</td>
      <td>3</td>
    </tr>
    <tr>
      <th>All</th>
      <td>55</td>
      <td>88</td>
      <td>79</td>
      <td>17</td>
      <td>20</td>
      <td>18</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Get plot-wise canopy cover percentage based on LiDAR derived canopy height model as the percentage of plot area with height more than 2 meters.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pcts <span class="op">=</span> []</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'../../data/raw/hiidenportti/full_mosaics/CHM_Hiidenportti_epsg.tif'</span>) <span class="im">as</span> src:</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    crs <span class="op">=</span> src.crs</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> plot_dw_data.itertuples():</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        plot_im, plot_tfm <span class="op">=</span> rio_mask.mask(src, [row.geometry], crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        pcts.append(plot_im[plot_im <span class="op">&gt;</span> <span class="dv">2</span>].shape[<span class="dv">0</span>] <span class="op">/</span> plot_im[plot_im <span class="op">&gt;=</span> <span class="dv">0</span>].shape[<span class="dv">0</span>])</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'canopy_cover_pct'</span>] <span class="op">=</span> pcts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot the relationship between annotated deadwood and field data.</p>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Same for field data and predictions</p>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Next the relationship between canopy cover and types of detected deadwood.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.lmplot(data<span class="op">=</span>plot_dw_data, x<span class="op">=</span><span class="st">'n_udw_plot'</span>, y<span class="op">=</span><span class="st">'canopy_cover_pct'</span>, col<span class="op">=</span><span class="st">'conservation'</span>, hue<span class="op">=</span><span class="st">'conservation'</span>, ci<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Managed forests'</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Protected forests'</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>g.set_ylabels(<span class="st">'Canopy cover percentage for field plots'</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>g.set_xlabels(<span class="st">'Number of field-measured standing deadwood within plots'</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.lmplot(data<span class="op">=</span>plot_dw_data, x<span class="op">=</span><span class="st">'n_udw_pred'</span>, y<span class="op">=</span><span class="st">'canopy_cover_pct'</span>, col<span class="op">=</span><span class="st">'conservation'</span>, hue<span class="op">=</span><span class="st">'conservation'</span>, ci<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Managed forests'</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Protected forests'</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>g.set_ylabels(<span class="st">'Canopy cover percentage for field plots'</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>g.set_xlabels(<span class="st">'Number of predicted standing deadwood within plots'</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.lmplot(data<span class="op">=</span>plot_dw_data, x<span class="op">=</span><span class="st">'n_ddw_plot'</span>, y<span class="op">=</span><span class="st">'canopy_cover_pct'</span>, col<span class="op">=</span><span class="st">'conservation'</span>, hue<span class="op">=</span><span class="st">'conservation'</span>, ci<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Managed forests'</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Protected forests'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>g.set_ylabels(<span class="st">'Canopy cover percentage for field plots'</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>g.set_xlabels(<span class="st">'Number of field-measured fallen deadwood within plots'</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.lmplot(data<span class="op">=</span>plot_dw_data, x<span class="op">=</span><span class="st">'n_ddw_pred'</span>, y<span class="op">=</span><span class="st">'canopy_cover_pct'</span>, col<span class="op">=</span><span class="st">'conservation'</span>, hue<span class="op">=</span><span class="st">'conservation'</span>, ci<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Managed forests'</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Protected forests'</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>g.set_ylabels(<span class="st">'Canopy cover percentage for field plots'</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>g.set_xlabels(<span class="st">'Number of predicted fallen deadwood within plots'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Note that for the test set there are too few plots to draw meaningful conclusions.</p>
<p>Add information about conservation area to tree data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>tree_data <span class="op">=</span> tree_data[tree_data.plot_id.isin(plot_dw_data.<span class="bu">id</span>.unique())]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>tree_data[<span class="st">'conservation'</span>] <span class="op">=</span> tree_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: plot_dw_data[plot_dw_data.<span class="bu">id</span> <span class="op">==</span> row.plot_id].conservation.unique()[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>preds_in_plots[<span class="st">'conservation'</span>] <span class="op">=</span> preds_in_plots.<span class="bu">apply</span>(<span class="kw">lambda</span> row: plot_dw_data[plot_dw_data.<span class="bu">id</span> <span class="op">==</span> row.plot_id].conservation.unique()[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>anns_in_plots[<span class="st">'tree_length'</span>] <span class="op">=</span> anns_in_plots.<span class="bu">apply</span>(<span class="kw">lambda</span> row: get_len(row.geometry), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>preds_in_plots[<span class="st">'tree_length'</span>] <span class="op">=</span> preds_in_plots.<span class="bu">apply</span>(<span class="kw">lambda</span> row: get_len(row.geometry), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Compare the distributions of the downed trunk lengths. Both graphs only take the parts within the plots into account. Lengths are binned into 1m bins.</p>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As expected, annotated trunks are clearly on average shorter than field measured.</p>
<p>Compare the measured DBH for downed trees and estimated diameter of annotated downed deadwood. For annotated deadwood, the diameter is estimated for the whole tree, not only for the part within the field plot. DBHs are binned into 50mm bins.</p>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>See the statistics for groundwood length and diameter. First for field data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data<span class="op">=</span>tree_data[(tree_data.tree_class <span class="op">==</span> <span class="dv">4</span>)<span class="op">&amp;</span>(tree_data.DBH<span class="op">&gt;</span><span class="dv">0</span>)],</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>               index<span class="op">=</span>[<span class="st">'conservation'</span>], values<span class="op">=</span>[<span class="st">'l'</span>, <span class="st">'DBH'</span>],</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>               aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>], margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">mean</th>
      <th colspan="2" halign="left">min</th>
      <th colspan="2" halign="left">max</th>
    </tr>
    <tr>
      <th></th>
      <th>DBH</th>
      <th>l</th>
      <th>DBH</th>
      <th>l</th>
      <th>DBH</th>
      <th>l</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>140.100016</td>
      <td>7.040370</td>
      <td>15.558197</td>
      <td>0.518478</td>
      <td>371.498790</td>
      <td>14.855550</td>
    </tr>
    <tr>
      <th>1</th>
      <td>206.043641</td>
      <td>8.075359</td>
      <td>86.112222</td>
      <td>0.214113</td>
      <td>580.560964</td>
      <td>18.000666</td>
    </tr>
    <tr>
      <th>All</th>
      <td>173.821188</td>
      <td>7.569625</td>
      <td>15.558197</td>
      <td>0.214113</td>
      <td>580.560964</td>
      <td>18.000666</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Then for predictions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data<span class="op">=</span>preds_in_plots[(preds_in_plots.label<span class="op">==</span><span class="dv">2</span>)<span class="op">&amp;</span>(preds_in_plots.tree_length <span class="op">&gt;=</span> <span class="fl">0.1</span>)], </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>               index<span class="op">=</span>[<span class="st">'conservation'</span>], values<span class="op">=</span>[<span class="st">'tree_length'</span>, <span class="st">'diam'</span>],</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>               aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>], margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">mean</th>
      <th colspan="2" halign="left">min</th>
      <th colspan="2" halign="left">max</th>
    </tr>
    <tr>
      <th></th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>166.508194</td>
      <td>1.889520</td>
      <td>10.889255</td>
      <td>0.281128</td>
      <td>301.422460</td>
      <td>5.605036</td>
    </tr>
    <tr>
      <th>1</th>
      <td>172.456022</td>
      <td>1.524233</td>
      <td>6.250000</td>
      <td>0.285395</td>
      <td>350.669633</td>
      <td>4.077773</td>
    </tr>
    <tr>
      <th>All</th>
      <td>168.207574</td>
      <td>1.785152</td>
      <td>6.250000</td>
      <td>0.281128</td>
      <td>350.669633</td>
      <td>5.605036</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Then compare the statistics for volume estimations, first for field data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>anns_in_plots[<span class="st">'v_ddw'</span>] <span class="op">=</span> anns_in_plots.geometry.<span class="bu">apply</span>(cut_cone_volume)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'v_ddw_ann'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: anns_in_plots[(anns_in_plots.plot_id <span class="op">==</span> row.<span class="bu">id</span>) <span class="op">&amp;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                                                                        (anns_in_plots.layer <span class="op">==</span> <span class="st">'groundwood'</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                                                                       ].v_ddw.<span class="bu">sum</span>()</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                                              , axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>preds_in_plots[<span class="st">'v_ddw'</span>] <span class="op">=</span> preds_in_plots.geometry.<span class="bu">apply</span>(cut_cone_volume)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'v_ddw_pred'</span>] <span class="op">=</span> plot_dw_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: preds_in_plots[(preds_in_plots.plot_id <span class="op">==</span> row.<span class="bu">id</span>) <span class="op">&amp;</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                                                                        (preds_in_plots.layer <span class="op">==</span> <span class="st">'groundwood'</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                                                                       ].v_ddw.<span class="bu">sum</span>()</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>                                              , axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'v_dw_plot'</span>] <span class="op">=</span> (plot_dw_data[<span class="st">'v_dw'</span>]<span class="op">/</span><span class="dv">10000</span>)<span class="op">*</span>np.pi<span class="op">*</span><span class="dv">9</span><span class="op">**</span><span class="dv">2</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'v_ddw_plot'</span>] <span class="op">=</span> (plot_dw_data[<span class="st">'v_ddw'</span>]<span class="op">/</span><span class="dv">10000</span>)<span class="op">*</span>np.pi<span class="op">*</span><span class="dv">9</span><span class="op">**</span><span class="dv">2</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'v_udw_plot'</span>] <span class="op">=</span> plot_dw_data.v_dw_plot <span class="op">-</span> plot_dw_data.v_ddw_plot</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data<span class="op">=</span>plot_dw_data, index<span class="op">=</span>[<span class="st">'conservation'</span>], values<span class="op">=</span>[<span class="st">'v_ddw'</span>],</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>               aggfunc<span class="op">=</span>[<span class="st">'min'</span>, <span class="st">'max'</span>, <span class="st">'mean'</span>, <span class="st">'median'</span>,<span class="st">'std'</span>, <span class="st">'count'</span>], margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>median</th>
      <th>std</th>
      <th>count</th>
    </tr>
    <tr>
      <th></th>
      <th>v_ddw</th>
      <th>v_ddw</th>
      <th>v_ddw</th>
      <th>v_ddw</th>
      <th>v_ddw</th>
      <th>v_ddw</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.476682</td>
      <td>88.948335</td>
      <td>29.528714</td>
      <td>22.513292</td>
      <td>28.686318</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>65.155283</td>
      <td>139.171786</td>
      <td>82.494768</td>
      <td>71.816212</td>
      <td>28.298432</td>
      <td>6</td>
    </tr>
    <tr>
      <th>All</th>
      <td>1.476682</td>
      <td>139.171786</td>
      <td>50.715136</td>
      <td>48.100161</td>
      <td>38.439837</td>
      <td>15</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Then for predictions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>plot_dw_data[<span class="st">'v_ddw_pred_ha'</span>] <span class="op">=</span> (<span class="dv">10000</span> <span class="op">*</span> plot_dw_data.v_ddw_pred) <span class="op">/</span> (np.pi <span class="op">*</span> <span class="dv">9</span><span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data<span class="op">=</span>plot_dw_data, index<span class="op">=</span>[<span class="st">'conservation'</span>], values<span class="op">=</span>[<span class="st">'v_ddw_pred_ha'</span>],</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>               aggfunc<span class="op">=</span>[<span class="st">'min'</span>, <span class="st">'max'</span>, <span class="st">'mean'</span>, <span class="st">'median'</span>,<span class="st">'std'</span>, <span class="st">'count'</span>], margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>median</th>
      <th>std</th>
      <th>count</th>
    </tr>
    <tr>
      <th></th>
      <th>v_ddw_pred_ha</th>
      <th>v_ddw_pred_ha</th>
      <th>v_ddw_pred_ha</th>
      <th>v_ddw_pred_ha</th>
      <th>v_ddw_pred_ha</th>
      <th>v_ddw_pred_ha</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.239953</td>
      <td>24.857178</td>
      <td>13.098547</td>
      <td>11.497471</td>
      <td>8.527684</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.515183</td>
      <td>30.041972</td>
      <td>7.896543</td>
      <td>3.257221</td>
      <td>11.360618</td>
      <td>6</td>
    </tr>
    <tr>
      <th>All</th>
      <td>0.515183</td>
      <td>30.041972</td>
      <td>11.017745</td>
      <td>6.405077</td>
      <td>9.726651</td>
      <td>15</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Based on these plots, our predictions clearly underestimate the total volume of fallen deadwood, especially in conserved forests.</p>
</section>
</section>
<section id="sudenpesänkangas" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Sudenpesänkangas</h1>
<p>Read data and do some wrangling.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>evo_fd_path <span class="op">=</span> Path(<span class="st">'../data/sudenpesankangas/'</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>evo_anns <span class="op">=</span> gpd.read_file(<span class="st">'../../data/raw/sudenpesankangas/virtual_plots/sudenpesankangas_deadwood.geojson'</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>evo_anns <span class="op">=</span> evo_anns.to_crs(<span class="st">'epsg:3067'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>evo_preds <span class="op">=</span> gpd.read_file(<span class="st">'../results/sudenpesankangas/spk_merged_20220825.geojson'</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>evo_plot_circles <span class="op">=</span> gpd.read_file(evo_fd_path<span class="op">/</span><span class="st">'plot_circles.geojson'</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>evo_plot_circles[<span class="st">'id'</span>] <span class="op">=</span> evo_plot_circles[<span class="st">'id'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>evo_field_data <span class="op">=</span> pd.read_csv(evo_fd_path<span class="op">/</span><span class="st">'puutiedot_sudenpesänkangas.csv'</span>, sep<span class="op">=</span><span class="st">';'</span>, decimal<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>evo_field_data <span class="op">=</span> gpd.GeoDataFrame(evo_field_data, geometry<span class="op">=</span>gpd.points_from_xy(evo_field_data.gx, evo_field_data.gy), </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                                   crs<span class="op">=</span><span class="st">'epsg:3067'</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>evo_grid <span class="op">=</span> gpd.read_file(evo_fd_path<span class="op">/</span><span class="st">'vplots.geojson'</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>evo_grid <span class="op">=</span> evo_grid.to_crs(<span class="st">'epsg:3067'</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>evo_field_data[<span class="st">'plotid'</span>] <span class="op">=</span> evo_field_data.kaid <span class="op">+</span> <span class="dv">1000</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>evo_field_data <span class="op">=</span> evo_field_data[evo_field_data.puuluo.isin([<span class="dv">3</span>,<span class="dv">4</span>])]</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>cons_evo <span class="op">=</span> conservation_areas[conservation_areas.geometry.intersects(box(<span class="op">*</span>evo_anns.total_bounds))]</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>cons_evo <span class="op">=</span> gpd.clip(cons_evo, evo_grid)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> match_plotid_spk(geom, plots):</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> plots.itertuples():</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r.geometry.intersects(geom):</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> r.<span class="bu">id</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> match_vplot_spk(geom, plots):</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> plots.itertuples():</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> geom.intersects(p.geometry):</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f'</span><span class="sc">{</span>p<span class="sc">.</span>fid<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span><span class="bu">int</span>(p.<span class="bu">id</span>)<span class="sc">}</span><span class="ss">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Get up-to-date field data</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>evo_plots_updated <span class="op">=</span> pd.read_csv(evo_fd_path<span class="op">/</span><span class="st">'Koealatunnukset_Evo_2018.txt'</span>, sep<span class="op">=</span><span class="st">' '</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>evo_plots_luke <span class="op">=</span> pd.read_csv(evo_fd_path<span class="op">/</span><span class="st">'Koealatunnukset_Evo_2018_LUKE.txt'</span>, sep<span class="op">=</span><span class="st">' '</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>evo_plots_updated <span class="op">=</span> gpd.GeoDataFrame(evo_plots_updated, geometry<span class="op">=</span>gpd.points_from_xy(evo_plots_updated.x,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                                                                                    evo_plots_updated.y),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                                     crs<span class="op">=</span><span class="st">'epsg:3067'</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>evo_plots_luke <span class="op">=</span> gpd.GeoDataFrame(evo_plots_luke, geometry<span class="op">=</span>gpd.points_from_xy(evo_plots_luke.x,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                                                                              evo_plots_luke.y),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                                     crs<span class="op">=</span><span class="st">'epsg:3067'</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>evo_plots <span class="op">=</span> pd.concat([evo_plots_updated, evo_plots_luke])</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>evo_plots.rename(columns<span class="op">=</span> {c: c.replace(<span class="st">'.'</span>,<span class="st">'_'</span>) <span class="cf">for</span> c <span class="kw">in</span> evo_plots.columns}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'spk_id'</span>] <span class="op">=</span> evo_plots.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: match_plotid_spk(row, evo_plot_circles))</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>evo_plots.dropna(subset<span class="op">=</span><span class="st">'spk_id'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'geometry'</span>] <span class="op">=</span> evo_plots.spk_id.<span class="bu">apply</span>(<span class="kw">lambda</span> row: evo_plot_circles[evo_plot_circles.<span class="bu">id</span> <span class="op">==</span> row].geometry.iloc[<span class="dv">0</span>])</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>evo_plots.drop(columns<span class="op">=</span>[<span class="st">'id'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>evo_plots.rename(columns<span class="op">=</span>{<span class="st">'spk_id'</span>: <span class="st">'id'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'conservation'</span>] <span class="op">=</span> evo_plots.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="dv">1</span> <span class="cf">if</span> cons_evo.geometry.unary_union.intersects(row)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>                                                     <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>evo_anns[<span class="st">'plot_id'</span>] <span class="op">=</span> evo_anns.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="bu">int</span>(row.vplot_id.split(<span class="st">'_'</span>)[<span class="dv">1</span>]), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>evo_plots <span class="op">=</span> evo_plots[evo_plots.<span class="bu">id</span>.isin(evo_anns.plot_id.unique())]</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>evo_anns[<span class="st">'plot_id'</span>] <span class="op">=</span> evo_anns.<span class="bu">apply</span>(<span class="kw">lambda</span> row: match_circular_plot(row, evo_plots), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>evo_anns_in_plots <span class="op">=</span> evo_anns.overlay(evo_plots[[<span class="st">'geometry'</span>]])</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>evo_preds[<span class="st">'conservation'</span>] <span class="op">=</span> evo_preds.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="dv">1</span> <span class="cf">if</span> <span class="bu">any</span>(cons_evo.geometry.contains(row))</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>                                                         <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>evo_preds[<span class="st">'vplot_id'</span>] <span class="op">=</span> evo_preds.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: match_vplot_spk(row, evo_grid))</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>evo_preds[<span class="st">'plot_id'</span>] <span class="op">=</span> evo_preds.<span class="bu">apply</span>(<span class="kw">lambda</span> row: match_circular_plot(row, evo_plots), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>evo_preds_in_plots <span class="op">=</span> evo_preds.overlay(evo_plots[[<span class="st">'geometry'</span>]])</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>evo_preds_in_plots[<span class="st">'plot_id'</span>] <span class="op">=</span> evo_preds_in_plots.plot_id.astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="predictions-vs-annotations-all-available-data" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="predictions-vs-annotations-all-available-data"><span class="header-section-number">2.1</span> Predictions vs annotations, all available data</h2>
<p>Compare the numbers, first annotations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>pd.crosstab(evo_anns.conservation, evo_anns.label, margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>label</th>
      <th>groundwood</th>
      <th>uprightwood</th>
      <th>All</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2369</td>
      <td>386</td>
      <td>2755</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1546</td>
      <td>1033</td>
      <td>2579</td>
    </tr>
    <tr>
      <th>All</th>
      <td>3915</td>
      <td>1419</td>
      <td>5334</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Then predictions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>pd.crosstab(evo_preds.conservation, evo_preds.layer, margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>layer</th>
      <th>groundwood</th>
      <th>uprightwood</th>
      <th>All</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2437</td>
      <td>383</td>
      <td>2820</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1693</td>
      <td>807</td>
      <td>2500</td>
    </tr>
    <tr>
      <th>All</th>
      <td>4130</td>
      <td>1190</td>
      <td>5320</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Add lenght and diameter information to groundwood.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>evo_anns[<span class="st">'tree_length'</span>] <span class="op">=</span> evo_anns.geometry.<span class="bu">apply</span>(get_len)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>evo_preds[<span class="st">'tree_length'</span>] <span class="op">=</span> evo_preds.geometry.<span class="bu">apply</span>(get_len)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>evo_anns[<span class="st">'diam'</span>] <span class="op">=</span> evo_anns.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: np.mean(get_three_point_diams(row))) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>evo_preds[<span class="st">'diam'</span>] <span class="op">=</span> evo_preds.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: np.mean(get_three_point_diams(row))) <span class="op">*</span> <span class="dv">1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The clearest difference between these distributions are that on average the predictions are shorter than annotations.</p>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-49-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-50-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Then statistics for groundwood diameter and length. First annotations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>evo_anns[evo_anns.label<span class="op">==</span><span class="st">'groundwood'</span>].pivot_table(index<span class="op">=</span><span class="st">'conservation'</span>, values<span class="op">=</span>[<span class="st">'diam'</span>, <span class="st">'tree_length'</span>], </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                                       margins<span class="op">=</span><span class="va">True</span>, aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">mean</th>
      <th colspan="2" halign="left">min</th>
      <th colspan="2" halign="left">max</th>
    </tr>
    <tr>
      <th></th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>200.474161</td>
      <td>3.113435</td>
      <td>85.977992</td>
      <td>0.605847</td>
      <td>760.781151</td>
      <td>24.479043</td>
    </tr>
    <tr>
      <th>1</th>
      <td>254.250328</td>
      <td>3.914179</td>
      <td>101.096059</td>
      <td>0.575351</td>
      <td>709.170305</td>
      <td>22.625422</td>
    </tr>
    <tr>
      <th>All</th>
      <td>221.709909</td>
      <td>3.429642</td>
      <td>85.977992</td>
      <td>0.575351</td>
      <td>760.781151</td>
      <td>24.479043</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Then predictions. On average, predictions are both shorter and thinner than annotations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>evo_preds[evo_preds.layer<span class="op">==</span><span class="st">'groundwood'</span>].pivot_table(index<span class="op">=</span><span class="st">'conservation'</span>, values<span class="op">=</span>[<span class="st">'diam'</span>, <span class="st">'tree_length'</span>], </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                                           margins<span class="op">=</span><span class="va">True</span>, aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">mean</th>
      <th colspan="2" halign="left">min</th>
      <th colspan="2" halign="left">max</th>
    </tr>
    <tr>
      <th></th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>215.721066</td>
      <td>2.285198</td>
      <td>66.289676</td>
      <td>0.281653</td>
      <td>946.777021</td>
      <td>14.455624</td>
    </tr>
    <tr>
      <th>1</th>
      <td>237.056243</td>
      <td>2.832194</td>
      <td>90.435975</td>
      <td>0.251623</td>
      <td>710.128841</td>
      <td>18.956571</td>
    </tr>
    <tr>
      <th>All</th>
      <td>224.466939</td>
      <td>2.509427</td>
      <td>66.289676</td>
      <td>0.251623</td>
      <td>946.777021</td>
      <td>18.956571</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Check area covered by standing deadwood canopies. First annotations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>evo_anns[<span class="st">'area_m2'</span>] <span class="op">=</span> evo_anns.geometry.area</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>evo_preds[<span class="st">'area_m2'</span>] <span class="op">=</span> evo_preds.geometry.area</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>evo_anns[evo_anns.label<span class="op">==</span><span class="st">'uprightwood'</span>].pivot_table(index<span class="op">=</span><span class="st">'conservation'</span>, values<span class="op">=</span>[<span class="st">'area_m2'</span>], margins<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                                                    aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'sum'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mean</th>
      <th>sum</th>
    </tr>
    <tr>
      <th></th>
      <th>area_m2</th>
      <th>area_m2</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.142462</td>
      <td>1212.990283</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.811285</td>
      <td>6003.057735</td>
    </tr>
    <tr>
      <th>All</th>
      <td>5.085305</td>
      <td>7216.048018</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Then predictions. On average predicted canopies are larger than annotated.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>evo_preds[evo_preds.layer<span class="op">==</span><span class="st">'uprightwood'</span>].pivot_table(index<span class="op">=</span><span class="st">'conservation'</span>, values<span class="op">=</span>[<span class="st">'area_m2'</span>], margins<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                                                      aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'sum'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mean</th>
      <th>sum</th>
    </tr>
    <tr>
      <th></th>
      <th>area_m2</th>
      <th>area_m2</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.750448</td>
      <td>1436.421535</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.776561</td>
      <td>4661.684400</td>
    </tr>
    <tr>
      <th>All</th>
      <td>5.124459</td>
      <td>6098.105935</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>evo_anns[<span class="st">'v_ddw'</span>] <span class="op">=</span> evo_anns.geometry.<span class="bu">apply</span>(cut_cone_volume)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>evo_preds[<span class="st">'v_ddw'</span>] <span class="op">=</span> evo_preds.geometry.<span class="bu">apply</span>(cut_cone_volume)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>evo_vplot_area <span class="op">=</span> evo_grid.area.<span class="bu">sum</span>()</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>evo_cons_area <span class="op">=</span> cons_evo.area.<span class="bu">sum</span>()</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>evo_man_area <span class="op">=</span> evo_vplot_area <span class="op">-</span> evo_cons_area</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>evo_man_ha <span class="op">=</span> evo_man_area <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>evo_cons_ha <span class="op">=</span> evo_cons_area <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>evo_ann_est_v_man <span class="op">=</span> evo_anns[(evo_anns.label<span class="op">==</span><span class="st">'groundwood'</span>)<span class="op">&amp;</span>(evo_anns.conservation<span class="op">==</span><span class="dv">0</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>evo_man_ha</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>evo_ann_est_v_cons <span class="op">=</span> evo_anns[(evo_anns.label<span class="op">==</span><span class="st">'groundwood'</span>)<span class="op">&amp;</span>(evo_anns.conservation<span class="op">==</span><span class="dv">1</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>evo_cons_ha</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>evo_ann_est_v <span class="op">=</span> evo_anns[(evo_anns.label<span class="op">==</span><span class="st">'groundwood'</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>(evo_vplot_area<span class="op">/</span><span class="dv">10000</span>)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>evo_pred_est_v_man <span class="op">=</span> evo_preds[(evo_preds.layer<span class="op">==</span><span class="st">'groundwood'</span>)<span class="op">&amp;</span>(evo_preds.conservation<span class="op">==</span><span class="dv">0</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>evo_man_ha</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>evo_pred_est_v_cons <span class="op">=</span> evo_preds[(evo_preds.layer<span class="op">==</span><span class="st">'groundwood'</span>)<span class="op">&amp;</span>(evo_preds.conservation<span class="op">==</span><span class="dv">1</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>evo_cons_ha</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>evo_pred_est_v <span class="op">=</span> evo_preds[(evo_preds.layer<span class="op">==</span><span class="st">'groundwood'</span>)].v_ddw.<span class="bu">sum</span>()<span class="op">/</span>(evo_vplot_area<span class="op">/</span><span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in managed forests, based on annotations: </span><span class="sc">{</span>evo_ann_est_v_man<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in conserved forests, based on annotations: </span><span class="sc">{</span>evo_ann_est_v_cons<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in both types, based on annotations: </span><span class="sc">{</span>evo_ann_est_v<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Estimated groundwood volume in managed forests, based on annotations: 7.08 ha/m³
Estimated groundwood volume in conserved forests, based on annotations: 13.97 ha/m³
Estimated groundwood volume in both types, based on annotations: 9.90 ha/m³</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in managed forests, based on predictions: </span><span class="sc">{</span>evo_pred_est_v_man<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in conserved forests, based on predictions: </span><span class="sc">{</span>evo_pred_est_v_cons<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Estimated groundwood volume in both types, based on predictions: </span><span class="sc">{</span>evo_pred_est_v<span class="sc">:.2f}</span><span class="ss"> ha/m³'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Estimated groundwood volume in managed forests, based on predictions: 7.03 ha/m³
Estimated groundwood volume in conserved forests, based on predictions: 10.17 ha/m³
Estimated groundwood volume in both types, based on predictions: 8.31 ha/m³</code></pre>
</div>
</div>
</section>
<section id="predictions-vs-field-data-plot-wise" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="predictions-vs-field-data-plot-wise"><span class="header-section-number">2.2</span> Predictions vs field data, plot-wise</h2>
<p>Add canopy density based on LiDAR derived canopy height model. The density is the percentage of field plot area with height above 2 meters.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>pcts <span class="op">=</span> []</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'../../data/raw/sudenpesankangas/full_mosaics/sudenpesankangas_chm.tif'</span>) <span class="im">as</span> src:</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> evo_plots.itertuples():</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        plot_im, plot_tfm <span class="op">=</span> rio_mask.mask(src, [row.geometry], crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        pcts.append(plot_im[plot_im <span class="op">&gt;</span> <span class="dv">2</span>].shape[<span class="dv">0</span>] <span class="op">/</span> plot_im[plot_im <span class="op">&gt;=</span> <span class="dv">0</span>].shape[<span class="dv">0</span>])</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'canopy_cover_pct'</span>] <span class="op">=</span> pcts</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data<span class="op">=</span>evo_plots, index<span class="op">=</span>[<span class="st">'conservation'</span>], values<span class="op">=</span>[<span class="st">'canopy_cover_pct'</span>],</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>               aggfunc<span class="op">=</span>[<span class="st">'min'</span>, <span class="st">'max'</span>, <span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'count'</span>], margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>std</th>
      <th>count</th>
    </tr>
    <tr>
      <th></th>
      <th>canopy_cover_pct</th>
      <th>canopy_cover_pct</th>
      <th>canopy_cover_pct</th>
      <th>canopy_cover_pct</th>
      <th>canopy_cover_pct</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.237288</td>
      <td>0.989960</td>
      <td>0.782452</td>
      <td>0.200439</td>
      <td>42</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.678000</td>
      <td>0.991992</td>
      <td>0.869878</td>
      <td>0.085901</td>
      <td>29</td>
    </tr>
    <tr>
      <th>All</th>
      <td>0.237288</td>
      <td>0.991992</td>
      <td>0.818162</td>
      <td>0.168393</td>
      <td>71</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Count the number of deadwood instances similarly as for Hiidenportti data and plot the relationship between them.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'n_dw_ann'</span>] <span class="op">=</span> evo_plots.<span class="bu">apply</span>(<span class="kw">lambda</span> row: evo_anns.plot_id.value_counts()[<span class="bu">int</span>(row.<span class="bu">id</span>)]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> evo_anns.plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'n_ddw_ann'</span>] <span class="op">=</span> evo_plots.<span class="bu">apply</span>(<span class="kw">lambda</span> row: evo_anns[evo_anns.label<span class="op">==</span><span class="st">'groundwood'</span>].plot_id.value_counts()[<span class="bu">int</span>(row.<span class="bu">id</span>)]</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> evo_anns[evo_anns.label<span class="op">==</span><span class="st">'groundwood'</span>].plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'n_udw_ann'</span>] <span class="op">=</span> evo_plots.<span class="bu">apply</span>(<span class="kw">lambda</span> row: evo_anns[evo_anns.label<span class="op">!=</span><span class="st">'groundwood'</span>].plot_id.value_counts()[<span class="bu">int</span>(row.<span class="bu">id</span>)]</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> evo_anns[evo_anns.label<span class="op">!=</span><span class="st">'groundwood'</span>].plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'n_dw_plot'</span>] <span class="op">=</span> np.<span class="bu">round</span>((evo_plots[<span class="st">'n_dw'</span>]<span class="op">/</span><span class="dv">10000</span>)<span class="op">*</span>np.pi<span class="op">*</span><span class="dv">9</span><span class="op">**</span><span class="dv">2</span>).astype(<span class="bu">int</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'n_ddw_plot'</span>] <span class="op">=</span> np.<span class="bu">round</span>((evo_plots[<span class="st">'n_ddw'</span>]<span class="op">/</span><span class="dv">10000</span>)<span class="op">*</span>np.pi<span class="op">*</span><span class="dv">9</span><span class="op">**</span><span class="dv">2</span>).astype(<span class="bu">int</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'n_udw_plot'</span>] <span class="op">=</span> evo_plots.n_dw_plot <span class="op">-</span> evo_plots.n_ddw_plot</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'conservation'</span>] <span class="op">=</span> evo_plots.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="dv">1</span> <span class="cf">if</span> <span class="bu">any</span>(cons_evo.geometry.contains(row.geometry))</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>                                                        <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'n_dw_pred'</span>] <span class="op">=</span> evo_plots.<span class="bu">apply</span>(<span class="kw">lambda</span> row: evo_preds.plot_id.value_counts()[<span class="bu">int</span>(row.<span class="bu">id</span>)]</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> evo_preds.plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'n_ddw_pred'</span>] <span class="op">=</span> evo_plots.<span class="bu">apply</span>(<span class="kw">lambda</span> row: evo_preds[evo_preds.layer<span class="op">==</span><span class="st">'groundwood'</span>].plot_id.value_counts()[<span class="bu">int</span>(row.<span class="bu">id</span>)]</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> evo_preds[evo_preds.layer<span class="op">==</span><span class="st">'groundwood'</span>].plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'n_udw_pred'</span>] <span class="op">=</span> evo_plots.<span class="bu">apply</span>(<span class="kw">lambda</span> row: evo_preds[evo_preds.layer<span class="op">!=</span><span class="st">'groundwood'</span>].plot_id.value_counts()[<span class="bu">int</span>(row.<span class="bu">id</span>)]</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> row.<span class="bu">id</span> <span class="kw">in</span> evo_preds[evo_preds.layer<span class="op">!=</span><span class="st">'groundwood'</span>].plot_id.unique() <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Compare the number of annotations, predictions and field measurements within plots.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>evo_plots.pivot_table(index<span class="op">=</span><span class="st">'conservation'</span>, values<span class="op">=</span>[<span class="st">'n_ddw_plot'</span>, <span class="st">'n_udw_plot'</span>, <span class="st">'n_ddw_ann'</span>, <span class="st">'n_udw_ann'</span>, </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">'n_ddw_pred'</span>, <span class="st">'n_udw_pred'</span>], </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                         aggfunc<span class="op">=</span><span class="st">'sum'</span>, margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>n_ddw_ann</th>
      <th>n_ddw_plot</th>
      <th>n_ddw_pred</th>
      <th>n_udw_ann</th>
      <th>n_udw_plot</th>
      <th>n_udw_pred</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>65</td>
      <td>14</td>
      <td>59</td>
      <td>14</td>
      <td>68</td>
      <td>11</td>
    </tr>
    <tr>
      <th>1</th>
      <td>22</td>
      <td>29</td>
      <td>30</td>
      <td>29</td>
      <td>92</td>
      <td>21</td>
    </tr>
    <tr>
      <th>All</th>
      <td>87</td>
      <td>43</td>
      <td>89</td>
      <td>43</td>
      <td>160</td>
      <td>32</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Plot the relationship between annotated and field data.</p>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-61-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Same for field data and predictions.</p>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-62-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Relationship between canopy cover and deadwood.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.lmplot(data<span class="op">=</span>evo_plots, x<span class="op">=</span><span class="st">'n_udw_plot'</span>, y<span class="op">=</span><span class="st">'canopy_cover_pct'</span>, col<span class="op">=</span><span class="st">'conservation'</span>, hue<span class="op">=</span><span class="st">'conservation'</span>, ci<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Managed forests'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Protected forests'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>g.set_ylabels(<span class="st">'Canopy cover percentage for field plots'</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>g.set_xlabels(<span class="st">'Number of field-measured standing deadwood within plots'</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-63-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.lmplot(data<span class="op">=</span>evo_plots, x<span class="op">=</span><span class="st">'n_udw_pred'</span>, y<span class="op">=</span><span class="st">'canopy_cover_pct'</span>, col<span class="op">=</span><span class="st">'conservation'</span>, hue<span class="op">=</span><span class="st">'conservation'</span>, ci<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Managed forests'</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Protected forests'</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>g.set_ylabels(<span class="st">'Canopy cover percentage for field plots'</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>g.set_xlabels(<span class="st">'Number of predicted standing deadwood within plots'</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-64-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.lmplot(data<span class="op">=</span>evo_plots, x<span class="op">=</span><span class="st">'n_ddw_plot'</span>, y<span class="op">=</span><span class="st">'canopy_cover_pct'</span>, col<span class="op">=</span><span class="st">'conservation'</span>, hue<span class="op">=</span><span class="st">'conservation'</span>, ci<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Managed forests'</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Protected forests'</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>g.set_ylabels(<span class="st">'Canopy cover percentage for field plots'</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>g.set_xlabels(<span class="st">'Number of field-measured fallen deadwood within plots'</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-65-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.lmplot(data<span class="op">=</span>evo_plots, x<span class="op">=</span><span class="st">'n_ddw_ann'</span>, y<span class="op">=</span><span class="st">'canopy_cover_pct'</span>, col<span class="op">=</span><span class="st">'conservation'</span>, hue<span class="op">=</span><span class="st">'conservation'</span>, ci<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Managed forests'</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>g.axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Protected forests'</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>g.set_ylabels(<span class="st">'Canopy cover percentage for field plots'</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>g.set_xlabels(<span class="st">'Number of predicted fallen deadwood within plots'</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-66-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As Evo data doesn’t have field-measured deadwood lengths, we can’t plot that relationship. We can, however, plot the DBH distributions, even though Evo dataset only has around 50 downed deadwood with dbh measured.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>evo_field_data <span class="op">=</span> evo_field_data[evo_field_data.plotid.isin(evo_plots.<span class="bu">id</span>.unique())]</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>evo_field_data[<span class="st">'conservation'</span>] <span class="op">=</span> evo_field_data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: evo_plots[evo_plots.<span class="bu">id</span> <span class="op">==</span> row.plotid].conservation.unique()[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-68-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="6_result_comparison_with_field_data_files/figure-html/cell-69-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><code>est_pituus_m</code> is the estimated lenght of the deadwood, based on DBH (<code>lapimitta_mm</code>) and growth formulae, so that is really inaccurate.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data<span class="op">=</span>evo_field_data[(evo_field_data.puuluo <span class="op">==</span> <span class="dv">4</span>)<span class="op">&amp;</span>(evo_field_data.lapimitta_mm<span class="op">&gt;</span><span class="dv">0</span>)],</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>               index<span class="op">=</span>[<span class="st">'conservation'</span>], values<span class="op">=</span>[<span class="st">'est_pituus_m'</span>, <span class="st">'lapimitta_mm'</span>],</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>               aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>, <span class="st">'count'</span>], margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">mean</th>
      <th colspan="2" halign="left">min</th>
      <th colspan="2" halign="left">max</th>
      <th colspan="2" halign="left">count</th>
    </tr>
    <tr>
      <th></th>
      <th>est_pituus_m</th>
      <th>lapimitta_mm</th>
      <th>est_pituus_m</th>
      <th>lapimitta_mm</th>
      <th>est_pituus_m</th>
      <th>lapimitta_mm</th>
      <th>est_pituus_m</th>
      <th>lapimitta_mm</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13.609571</td>
      <td>169.357143</td>
      <td>5.934</td>
      <td>55</td>
      <td>34.211</td>
      <td>552</td>
      <td>14</td>
      <td>14</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11.905690</td>
      <td>115.896552</td>
      <td>5.446</td>
      <td>45</td>
      <td>28.101</td>
      <td>445</td>
      <td>29</td>
      <td>29</td>
    </tr>
    <tr>
      <th>All</th>
      <td>12.460442</td>
      <td>133.302326</td>
      <td>5.446</td>
      <td>45</td>
      <td>34.211</td>
      <td>552</td>
      <td>43</td>
      <td>43</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Length and diameter statistics for predictions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>evo_preds_in_plots[<span class="st">'tree_length'</span>] <span class="op">=</span> evo_preds_in_plots.geometry.<span class="bu">apply</span>(get_len)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data<span class="op">=</span>evo_preds_in_plots[evo_preds_in_plots.label<span class="op">==</span><span class="dv">2</span>], index<span class="op">=</span>[<span class="st">'conservation'</span>], </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>               values<span class="op">=</span>[<span class="st">'tree_length'</span>, <span class="st">'diam'</span>],</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>               aggfunc<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>], margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">mean</th>
      <th colspan="2" halign="left">min</th>
      <th colspan="2" halign="left">max</th>
    </tr>
    <tr>
      <th></th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
      <th>diam</th>
      <th>tree_length</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>215.914297</td>
      <td>1.962542</td>
      <td>69.619593</td>
      <td>0.375545</td>
      <td>502.915702</td>
      <td>9.128894</td>
    </tr>
    <tr>
      <th>1</th>
      <td>211.666849</td>
      <td>2.007725</td>
      <td>74.672309</td>
      <td>0.242613</td>
      <td>356.577743</td>
      <td>6.525554</td>
    </tr>
    <tr>
      <th>All</th>
      <td>214.482573</td>
      <td>1.977772</td>
      <td>69.619593</td>
      <td>0.242613</td>
      <td>502.915702</td>
      <td>9.128894</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Estimated volume statistics for Evo area. First based on field data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>evo_preds_in_plots[<span class="st">'v_ddw'</span>] <span class="op">=</span> evo_preds_in_plots.geometry.<span class="bu">apply</span>(cut_cone_volume)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'v_ddw_pred'</span>] <span class="op">=</span> evo_plots.<span class="bu">apply</span>(<span class="kw">lambda</span> row: evo_preds_in_plots[(evo_preds_in_plots.plot_id <span class="op">==</span> row.<span class="bu">id</span>) <span class="op">&amp;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                                                              (evo_preds_in_plots.layer <span class="op">==</span> <span class="st">'groundwood'</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                                                              ].v_ddw.<span class="bu">sum</span>()</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                                              , axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>evo_plots[<span class="st">'v_ddw_pred_ha'</span>] <span class="op">=</span> (<span class="dv">10000</span> <span class="op">*</span> evo_plots.v_ddw_pred) <span class="op">/</span> (np.pi <span class="op">*</span> <span class="dv">9</span><span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data<span class="op">=</span>evo_plots, index<span class="op">=</span>[<span class="st">'conservation'</span>], values<span class="op">=</span>[<span class="st">'v_ddw'</span>],</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>               aggfunc<span class="op">=</span>[<span class="st">'min'</span>, <span class="st">'max'</span>, <span class="st">'mean'</span>, <span class="st">'median'</span>,<span class="st">'std'</span>, <span class="st">'count'</span>], margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>median</th>
      <th>std</th>
      <th>count</th>
    </tr>
    <tr>
      <th></th>
      <th>v_ddw</th>
      <th>v_ddw</th>
      <th>v_ddw</th>
      <th>v_ddw</th>
      <th>v_ddw</th>
      <th>v_ddw</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>123.004587</td>
      <td>5.522673</td>
      <td>0.0</td>
      <td>23.497052</td>
      <td>42</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>98.258093</td>
      <td>6.338610</td>
      <td>0.0</td>
      <td>18.873961</td>
      <td>29</td>
    </tr>
    <tr>
      <th>All</th>
      <td>0.0</td>
      <td>123.004587</td>
      <td>5.855943</td>
      <td>0.0</td>
      <td>21.587804</td>
      <td>71</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Then based on predictions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data<span class="op">=</span>evo_plots, index<span class="op">=</span>[<span class="st">'conservation'</span>], values<span class="op">=</span>[<span class="st">'v_ddw_pred_ha'</span>],</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>               aggfunc<span class="op">=</span>[<span class="st">'min'</span>, <span class="st">'max'</span>, <span class="st">'mean'</span>, <span class="st">'median'</span>,<span class="st">'std'</span>, <span class="st">'count'</span>], margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>median</th>
      <th>std</th>
      <th>count</th>
    </tr>
    <tr>
      <th></th>
      <th>v_ddw_pred_ha</th>
      <th>v_ddw_pred_ha</th>
      <th>v_ddw_pred_ha</th>
      <th>v_ddw_pred_ha</th>
      <th>v_ddw_pred_ha</th>
      <th>v_ddw_pred_ha</th>
    </tr>
    <tr>
      <th>conservation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>66.098826</td>
      <td>5.599320</td>
      <td>0.000000</td>
      <td>13.330675</td>
      <td>42</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>32.592807</td>
      <td>4.048691</td>
      <td>1.193922</td>
      <td>6.801761</td>
      <td>29</td>
    </tr>
    <tr>
      <th>All</th>
      <td>0.0</td>
      <td>66.098826</td>
      <td>4.965964</td>
      <td>0.000000</td>
      <td>11.098662</td>
      <td>71</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./5_scene_level_results.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Scene level results</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./7_deriving_standwise_metrics_for_evo.html" class="pagination-link">
        <span class="nav-page-text">Deriving deadwood statistics for full Evo study area</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>